import React, { useState, useEffect } from 'react';

const App = () => {
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [step, setStep] = useState('Initialisation...');

  useEffect(() => {
    const debugLoad = async () => {
      try {
        console.log('ğŸš€ DÃ©marrage de l\'application...');
        setStep('VÃ©rification des composants React...');

        // Simuler un dÃ©lai
        await new Promise(resolve => setTimeout(resolve, 1000));

        console.log('âœ… React fonctionne correctement');
        setStep('Test des imports...');

        // Test des imports progressivement
        try {
          console.log('ğŸ“¦ Test import DateAccordion...');
          const DateAccordionModule = await import('./components/DateAccordion');
          console.log('âœ… DateAccordion importÃ© avec succÃ¨s');

          console.log('ğŸ“¦ Test import Statistics...');
          const StatisticsModule = await import('./components/Statistics');
          console.log('âœ… Statistics importÃ© avec succÃ¨s');

          console.log('ğŸ“¦ Test import ProjectManager...');
          const ProjectManagerModule = await import('./components/ProjectManager');
          console.log('âœ… ProjectManager importÃ© avec succÃ¨s');

          setStep('Test des services LowDB...');

          console.log('ğŸ—„ï¸ Test import database service...');
          const databaseModule = await import('./services/database');
          console.log('âœ… Database service importÃ©');

          console.log('ğŸ—„ï¸ Test import task service...');
          const taskServiceModule = await import('./services/taskService');
          console.log('âœ… Task service importÃ©');

          console.log('ğŸ—„ï¸ Test import project service...');
          const projectServiceModule = await import('./services/projectService');
          console.log('âœ… Project service importÃ©');

        } catch (importError) {
          console.error('âŒ Erreur d\'import:', importError);
          setError(`Erreur d'import: ${importError.message}`);
          return;
        }

        setStep('Application prÃªte !');
        setLoading(false);
        console.log('ğŸ‰ Tous les tests passÃ©s avec succÃ¨s !');

      } catch (err) {
        console.error('âŒ Erreur gÃ©nÃ©rale:', err);
        setError(err.message);
        setLoading(false);
      }
    };

    debugLoad();
  }, []);

  if (error) {
    return (
      <div style={{
        padding: '40px',
        fontFamily: 'Arial, sans-serif',
        backgroundColor: '#fee2e2',
        border: '2px solid #dc2626',
        borderRadius: '8px',
        margin: '20px',
        color: '#dc2626'
      }}>
        <h1>ğŸš¨ Erreur DÃ©tectÃ©e</h1>
        <p><strong>Message :</strong> {error}</p>
        <p><strong>Action :</strong> VÃ©rifiez la console pour plus de dÃ©tails</p>
        <button
          onClick={() => window.location.reload()}
          style={{
            padding: '10px 20px',
            backgroundColor: '#dc2626',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            cursor: 'pointer',
            marginTop: '10px'
          }}
        >
          Recharger la page
        </button>
      </div>
    );
  }

  if (loading) {
    return (
      <div style={{
        padding: '40px',
        fontFamily: 'Arial, sans-serif',
        backgroundColor: '#f0f9ff',
        border: '2px solid #0ea5e9',
        borderRadius: '8px',
        margin: '20px',
        textAlign: 'center'
      }}>
        <h1>ğŸ” Diagnostic en Cours...</h1>
        <div style={{
          width: '40px',
          height: '40px',
          border: '4px solid #e5e7eb',
          borderTop: '4px solid #0ea5e9',
          borderRadius: '50%',
          animation: 'spin 1s linear infinite',
          margin: '20px auto'
        }}></div>
        <p><strong>Ã‰tape actuelle :</strong> {step}</p>
        <p style={{ fontSize: '14px', color: '#6b7280', marginTop: '20px' }}>
          VÃ©rifiez la console du navigateur (F12) pour voir les dÃ©tails...
        </p>
        <style dangerouslySetInnerHTML={{
          __html: `
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
          `
        }} />
      </div>
    );
  }

  return (
    <div style={{
      padding: '40px',
      fontFamily: 'Arial, sans-serif',
      backgroundColor: '#f0fdf4',
      border: '2px solid #16a34a',
      borderRadius: '8px',
      margin: '20px'
    }}>
      <h1>ğŸ‰ Diagnostic TerminÃ© avec SuccÃ¨s !</h1>
      <p style={{ color: '#16a34a', fontWeight: 'bold' }}>
        âœ… Tous les composants et services sont correctement importÃ©s
      </p>

      <div style={{
        backgroundColor: 'white',
        padding: '20px',
        borderRadius: '6px',
        marginTop: '20px',
        border: '1px solid #d1d5db'
      }}>
        <h2>ğŸ“‹ RÃ©sultats du Test</h2>
        <ul style={{ lineHeight: '1.8' }}>
          <li>âœ… React et hooks fonctionnels</li>
          <li>âœ… Composants Task, TaskForm, DateAccordion importÃ©s</li>
          <li>âœ… Composants Statistics, ProjectManager importÃ©s</li>
          <li>âœ… Services LowDB (database, taskService, projectService) importÃ©s</li>
        </ul>
      </div>

      <div style={{ marginTop: '20px' }}>
        <p><strong>Prochaine Ã©tape :</strong></p>
        <p>Vous pouvez maintenant remplacer ce fichier par la version complÃ¨te de l'application !</p>
      </div>

      <button
        onClick={() => {
          console.log('ğŸ”„ RedÃ©marrage pour passer Ã  la version complÃ¨te...');
          alert('Diagnostic terminÃ© ! VÃ©rifiez la console et remplacez par la version complÃ¨te.');
        }}
        style={{
          padding: '12px 24px',
          backgroundColor: '#16a34a',
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
          marginTop: '20px',
          fontSize: '16px'
        }}
      >
        Diagnostic TerminÃ© âœ…
      </button>
    </div>
  );
};

export default App;